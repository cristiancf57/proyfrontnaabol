<!-- profile.component.html -->
<div class="profile-container">
  <!-- Portada con opción de edición -->
  <div class="cover-section position-relative">
    <div class="cover-image-container">
      <img [src]="coverImage" alt="Portada" class="cover-image">
      <div class="cover-overlay position-absolute top-0 end-0 m-3">
        <!-- <button class="btn btn-light btn-sm" (click)="triggerCoverImageChange()">
          <i class="bi bi-camera"></i> Cambiar portada
        </button> -->
      </div>
    </div>
    
    <!-- Imagen de perfil con opción de edición -->
    <div class="profile-image-section position-relative">
      <div class="profile-image-container">
        <img [src]="profileImage || 'assets/img/perfiles/default.jpg'" alt="Perfil" class="profile-image rounded-circle border border-4 border-white">
        <!-- Loading spinner -->
        <div *ngIf="loading" class="position-absolute top-0 start-0 w-100 h-100 bg-light bg-opacity-75 rounded-circle d-flex align-items-center justify-content-center">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>
        <div class="profile-image-overlay position-absolute bottom-0 end-0">
          <button class="btn btn-primary btn-sm rounded-circle" (click)="cambiarPerfil()">
            <i class="bi bi-camera-fill"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Inputs ocultos para selección de archivos -->
  <input type="file" id="profileImageInput" (change)="onProfileImageChange($event)" accept="image/*" style="display: none;">

  <!-- Información del perfil -->
  <div class="profile-info mt-5 pt-4">
    <div class="container">
      <div class="row">
        <div class="col-md-8">
          <h2 class="text-uppercase fw-bold"> {{ user?.nombre }} {{ user?.apellido }}</h2>
          <h4 class="text-uppercase fw-bold">{{ userCargo?.cargo?.descripcion }} | AREA DE {{ userCargo?.cargo?.area }}</h4>
          
          <div class="d-flex flex-wrap gap-3 mt-3">
            <span class="badge text-bg-success"><i class="bi bi-person-check"></i> {{ userCargo?.estado }}</span>
            <span class="text-muted"><i class="bi bi-person-lock"></i> {{ user?.username }}</span>
            <span class="text-muted"><i class="bi bi-envelope-at"></i> {{ user?.email }}</span>
            <span class="text-muted"><i class="bi bi-calendar-date"></i> Desde {{ userCargo?.fecha_inicio }}</span>
            <span class="text-muted"><i class="bi bi-telephone-inbound"></i> {{ user?.telefono }}</span>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- Modal para editar imágenes (opcional) -->
  <div class="image-actions mt-3">
    <div class="container">
      <div class="d-flex gap-2">
        <button class="btn btn-outline-secondary btn-sm" (click)="removeProfileImage()"><i class="bi bi-trash"></i> Eliminar perfil</button>
        <button class="btn btn-outline-secondary btn-sm me-2" (click)="editPerfil()" *ngIf="!mostrarFormulario"><i class="bi bi-pencil-square"></i> Editar perfil</button>
        <button class="btn btn-outline-danger btn-sm me-2" (click)="canelEdit()" *ngIf="mostrarFormulario"><i class="bi bi-arrow-return-left"></i> Canelar</button>
      </div>
    </div>
  </div>
</div>

<section class="section profile" *ngIf="mostrarFormulario && !loading">
      <div class="row justify-content-center mt-4">
        <div class="col-xl-6">

          <div class="card">
            <div class="card-body pt-3">
              <!-- Bordered Tabs -->
              <ul class="nav nav-tabs nav-tabs-bordered">

                <li class="nav-item">
                  <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-edit">Editar Datos</button>
                </li>

                <li class="nav-item">
                  <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-change-password">Cambiar Password</button>
                </li>

              </ul>
              <div class="tab-content pt-2">

                <div class="tab-pane fade show active profile-overview profile-edit pt-3" id="profile-edit">

                  <!-- Profile Edit Form -->
                  <form>
                    <div class="row mb-3">
                      <label for="nombre" class="col-md-4 col-lg-3 col-form-label">Nombre</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="nombre" type="text" class="form-control" id="nombre" value="{{user?.nombre}}">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="apellido" class="col-md-4 col-lg-3 col-form-label">Apellido</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="apellido" type="text" class="form-control" id="apellido" value="{{user?.apellido}}">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="telefono" class="col-md-4 col-lg-3 col-form-label">Telefono</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="telefono" type="text" class="form-control" id="telefono" value="{{ user?.telefono }}">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="Email" class="col-md-4 col-lg-3 col-form-label">Email</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="email" type="email" class="form-control" id="Email" value="{{ user?.email }}">
                      </div>
                    </div>
                    
                    <div class="row mb-3">
                      <label for="username" class="col-md-4 col-lg-3 col-form-label">Username</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="username" type="text" class="form-control" id="username" value="{{ user?.username }}">
                      </div>
                    </div>

                    <div class="text-center">
                      <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                  </form><!-- End Profile Edit Form -->

                </div>

                <div class="tab-pane fade pt-3" id="profile-change-password">
                  <!-- Change Password Form -->
                  <form>

                    <div class="row mb-3">
                      <label for="currentPassword" class="col-md-4 col-lg-3 col-form-label">Password Actual</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="password" type="password" class="form-control" id="currentPassword">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="newPassword" class="col-md-4 col-lg-3 col-form-label">Nuevo Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="newpassword" type="password" class="form-control" id="newPassword">
                      </div>
                    </div>

                    <div class="row mb-3">
                      <label for="renewPassword" class="col-md-4 col-lg-3 col-form-label">Repetir Nuevo Password</label>
                      <div class="col-md-8 col-lg-9">
                        <input name="renewpassword" type="password" class="form-control" id="renewPassword">
                      </div>
                    </div>

                    <div class="text-center">
                      <button type="submit" class="btn btn-primary">Cambiar Password</button>
                    </div>
                  </form><!-- End Change Password Form -->

                </div>

              </div><!-- End Bordered Tabs -->

            </div>
          </div>

        </div>
      </div>
    </section>